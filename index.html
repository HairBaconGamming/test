<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Update</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #0f0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .box { border: 1px dashed #333; padding: 20px; border-radius: 8px; text-align: center; background: #222; max-width: 500px; }
        h1 { font-size: 16px; margin-bottom: 20px; color: #888; text-transform: uppercase; letter-spacing: 2px; }
        
        /* Nút kéo thả */
        a.bookmark-btn {
            display: inline-block;
            text-decoration: none;
            background: #000;
            color: #fff;
            padding: 12px 24px;
            border: 1px solid #444;
            border-radius: 4px;
            font-weight: bold;
            cursor: move; /* Con trỏ dạng kéo */
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: all 0.2s;
        }
        a.bookmark-btn:hover { border-color: #0f0; color: #0f0; box-shadow: 0 0 10px rgba(0,255,0,0.2); }
        
        .guide { margin-top: 20px; font-size: 12px; color: #666; }
        textarea { margin-top: 20px; width: 100%; height: 50px; background: #111; border: 1px solid #333; color: #555; font-size: 10px; resize: none; border-radius: 4px; padding: 5px; }
    </style>
</head>
<body>

    <div class="box">
        <h1>Ninja Installer V5 (Pro)</h1>
        
        <a href="#" id="installer" class="bookmark-btn" title="Kéo nút này thả vào thanh dấu trang">⚡ KÉO TÔI LÊN THANH BOOKMARK</a>

        <div class="guide">
            <p>1. Hiển thị thanh dấu trang (Ctrl + Shift + B).</p>
            <p>2. Giữ chuột trái vào nút trên, kéo thả vào thanh đó.</p>
            <p>3. Vào trang thi, bấm nút vừa tạo -> <b>Ctrl + .</b> để chạy.</p>
        </div>

        <textarea id="raw-code" readonly onclick="this.select()"></textarea>
    </div>

    <script>
        // MÃ JS V5 (HIGH ACCURACY - GEMINI 1.5 PRO)
        const code = `javascript:(function(){var K="AIzaSyDYb4-gHY2dGrg8o56IuXbL1yVJFAeA4wo";var M="gemini-1.5-pro";if(window.k12NinjaRunning){console.log('Ninja đang ẩn nấp rồi!');return}window.k12NinjaRunning=true;var stat=document.createElement("div");Object.assign(stat.style,{position:"fixed",bottom:"0",left:"0",width:"2px",height:"2px",background:"transparent",zIndex:"999999",pointerEvents:"none"});document.body.appendChild(stat);function signal(c){stat.style.background=c}var answerMap=[];async function silentScroll(){signal("rgba(255,255,0,0.5)");let c=document.querySelector('#loadLearnContent1')||document.body;let last=-1;while(c.scrollTop+c.clientHeight<c.scrollHeight){if(c.scrollTop==last)break;last=c.scrollTop;c.scrollBy(0,2000);await new Promise(r=>setTimeout(r,50))}}function getQ(){let qs=document.querySelectorAll('li.item-question');if(qs.length==0)return null;let d=[];qs.forEach((q,i)=>{let t=q.getAttribute('data-element-type');let te=q.querySelector('.choice-top .title')||q.querySelector('.question-content');let txt=(te?te.innerText:q.innerText).replace(/\\(.*\\)/g,'').trim();let it={id:i+1,type:t,text:txt,sub:[]};if(t=='OnlyTrueFalseFour'){q.querySelectorAll('.choice-tr').forEach(tr=>{let t1=tr.querySelector('.choice-text');let t2=tr.querySelector('.text');it.sub.push((t1?t1.innerText.trim():'')+' '+(t2?t2.innerText.trim():''))})}else{q.querySelectorAll('.choice-info-val .radio label').forEach(l=>{it.sub.push(l.innerText.trim())})}d.push(it)});return d}function toggleHints(show){let style=show?"inset 4px 0 0 0 rgba(0, 0, 0, 0.15)":"none";answerMap.forEach(ans=>{let q=document.querySelectorAll('li.item-question')[ans.id-1];if(!q)return;if(ans.type=='tf'){q.querySelectorAll('.choice-tr').forEach(tr=>{let lb=tr.querySelector('.choice-text');if(lb){let txt=lb.innerText.trim().replace('.','').toLowerCase();let v=ans.val[txt];if(v!==undefined){let target=tr.querySelector(\`input[value="\${v?'true':'false'}"]\`);if(target&&target.parentElement){target.parentElement.style.boxShadow=style}}}})}else if(ans.type=='mc'){let char=ans.val.charAt(0).toUpperCase();q.querySelectorAll('.choice-info-val .radio label').forEach(l=>{if(l.innerText.trim().toUpperCase().startsWith(char)){l.style.boxShadow=style}})}})}async function core(){await silentScroll();let data=getQ();if(!data){signal("rgba(255,0,0,0.3)");return}let pmpt=\`Bạn là giáo viên xuất sắc. Hãy đọc kỹ câu hỏi, suy luận logic để tìm đáp án đúng nhất. Trả về JSON thuần. Input câu hỏi -> Output đáp án. 1. 'OnlyTrueFalseFour': {a:true/false...}. 2. Khác: "A"/"B"/"C"/"D". Output: [{"id":1,"type":"tf","val":{"a":true...}},{"id":2,"type":"mc","val":"A"}]. ĐỀ: \${JSON.stringify(data)}\`;try{let r=await fetch(\`https://generativelanguage.googleapis.com/v1beta/models/\${M}:generateContent?key=\${K}\`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:pmpt}]}]})});if(!r.ok)throw new Error(r.status);let j=await r.json();if(!j.candidates)throw new Error("No AI");let txt=j.candidates[0].content.parts[0].text.replace(/\`\`\`json|\`\`\`/g,'').trim();answerMap=JSON.parse(txt);signal("rgba(0,255,0,0.3)")}catch(e){console.error(e);signal("rgba(255,0,0,0.8)")}}document.addEventListener('keydown',(e)=>{if(e.ctrlKey&&e.key==='.'){e.preventDefault();core()}});document.addEventListener('keydown',(e)=>{if(e.key==='Alt'&&answerMap.length>0)toggleHints(true)});document.addEventListener('keyup',(e)=>{if(e.key==='Alt')toggleHints(false)});console.log("Ninja Mode V5: High Accuracy (Pro)");})();`;

        // Tự động gán code vào link và textbox
        document.getElementById('installer').href = code;
        document.getElementById('raw-code').value = code;
    </script>
</body>
</html>
